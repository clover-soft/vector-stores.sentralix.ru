### Шаг 7: Доменные ручки синхронизации индексов и статуса (не admin)
- Цель:
  - Дать фронтенду и внешнему бэкенду “продуктовые” эндпоинты для обновления состояния индекса из провайдера без использования админ-раздела.
  - Обеспечить доменную изоляцию через `X-Domain-Id`.
- Действия:
  - Добавить эндпоинт синхронизации одного индекса:
    - `POST /api/v1/indexes/{index_id}/sync`
    - Вход:
      - `index_id: str` (path)
      - `X-Domain-Id: str` (header)
      - (опционально) `force: bool` (query) — принудительно тянуть данные из провайдера даже при “свежем” статусе.
    - Выход (минимально):
      - обновлённый `IndexOut` (или объект со срезом полей) + `sync_report`.
    - Поведение:
      - Проверить, что индекс существует в домене.
      - Если у индекса нет `external_id` — вернуть 409/400 с понятной ошибкой.
      - Выполнить запрос к провайдеру для `external_id` и обновить в БД:
        - `rag_indexes.metadata.provider_payload` (полный payload)
        - `rag_indexes.indexing_status`
        - `rag_indexes.indexed_at`
      - Дополнительно (для отложенной индексации):
        - получить список файлов в индексе у провайдера (`list_vector_store_files`) и обновить агрегированный `indexing_status` по правилам:
          - если есть хотя бы один файл со статусом `failed` — индекс `failed`;
          - иначе если есть хотя бы один файл со статусом `in_progress` — индекс `in_progress`;
          - иначе если файлы есть и все `completed` — индекс `done`.
        - при этом синхронизация не должна ждать завершения индексации; она только “поллит” текущее состояние.
  - Добавить эндпоинт синхронизации списка индексов домена:
    - `POST /api/v1/indexes/sync`
    - Вход:
      - `X-Domain-Id: str` (header)
      - (опционально) `provider_type: str` (query)
    - Выход:
      - `items: list[IndexOut]` (или краткий отчёт)
      - `errors: list[str]`
    - Поведение:
      - Синхронизировать индексы домена (а не глобально), без привязки к `DEFAULT_DOMAIN_ID`.
      - Обновить агрегированный статус индексов по файлам (polling), без ожидания обработки при attach.
- Ожидаемый результат:
  - Фронтенд может обновлять статус индекса “по кнопке” и получать актуальные данные без доступа к `/api/v1/admin/*`.
- Критерии готовности (Definition of Done):
  - Реализованы ручки `POST /api/v1/indexes/{index_id}/sync` и `POST /api/v1/indexes/sync`.
  - Все операции фильтруют данные по `X-Domain-Id`.
  - При синхронизации сохраняется полный payload в `metadata.provider_payload`.
  - Обновляется агрегированный статус индексов по файлам (polling), без ожидания обработки при attach.
- Выполнено: да
